//>>built
(function(d){"object"===typeof module&&"object"===typeof module.exports?(d=d(require,exports),void 0!==d&&(module.exports=d)):"function"===typeof define&&define.amd&&define(["require","exports","tslib","../core/QueuingEvented","./history/HashHistory"],d)})(function(d,l){Object.defineProperty(l,"__esModule",{value:!0});var k=d("tslib"),n=d("../core/QueuingEvented"),z=d("./history/HashHistory"),u=Symbol("routing param");d=function(d){function g(b,e){void 0===e&&(e={});var a=d.call(this)||this;a._routes=
[];a._outletMap=Object.create(null);a._matchedOutlets=Object.create(null);a._currentParams={};a._currentQueryParams={};a._onChange=function(b){a.emit({type:"navstart"});a._matchedOutlets=Object.create(null);a._currentParams={};b=a._stripLeadingSlash(b);b=k.__read(b.split("?"),2);var c=b[0];a._currentQueryParams=a._getQueryParams(b[1]);var e,f;b=k.__spread(a._routes);for(var d=0,c=c.split("/"),v=!1,g;0<b.length&&0!==c.length;){var h=b.shift(),q=h.onEnter,l=h.onExit,x="index",n=k.__spread(c),t=!0,r=
0;if(c.length<h.segments.length)t=!1;else for(;0<c.length;){if(void 0===h.segments[r]){x="partial";break}var y=c.shift();if(h.segments[r]===u)a._currentParams[h.params[d++]]=y;else if(h.segments[r]!==y){t=!1;break}r++}!0===t?(g=h.outlet,v=!0,a._matchedOutlets[h.outlet]={queryParams:a._currentQueryParams,params:k.__assign({},a._currentParams),type:x,onEnter:q,onExit:l},e=a._matchedOutlets[h.outlet],f=h.outlet,h.children.length&&(d=0),b=k.__spread(h.children)):(void 0!==g&&0===b.length&&(a._matchedOutlets[g].type=
"error"),c=k.__spread(n))}!1===v&&(a._matchedOutlets.errorOutlet={queryParams:a._currentQueryParams,params:k.__assign({},a._currentParams),type:"error"});f&&e&&a.emit({type:"nav",outlet:f,context:e})};var f=e.HistoryManager,f=void 0===f?z.HashHistory:f,c=e.base;e=e.window;a._register(b);a._history=new f({onChange:a._onChange,base:c,window:e});a._matchedOutlets.errorOutlet&&a._defaultOutlet&&(b=a.link(a._defaultOutlet))&&a.setPath(b);return a}k.__extends(g,d);g.prototype.setPath=function(b){this._history.set(b)};
g.prototype.link=function(b,e){void 0===e&&(e={});var a=this._currentParams,f=this._currentQueryParams,c=this._outletMap[b];if(void 0!==c){b=c.fullPath;if(0<c.fullQueryParams.length){var d=c.fullQueryParams.reduce(function(a,b,c){return 0<c?a+"\x26"+b+"\x3d{"+b+"}":"?"+b+"\x3d{"+b+"}"},"");b=""+b+d}e=k.__assign({},c.defaultParams,f,a,e);if(!(0===Object.keys(e).length&&0<c.fullParams.length)){a=k.__spread(c.fullParams,c.fullQueryParams);for(f=0;f<a.length;f++)if(c=a[f],e[c])b=b.replace("{"+c+"}",e[c]);
else return;return b}}};g.prototype.getOutlet=function(b){return this._matchedOutlets[b]};Object.defineProperty(g.prototype,"currentParams",{get:function(){return this._currentParams},enumerable:!0,configurable:!0});g.prototype._stripLeadingSlash=function(b){return"/"===b[0]?b.slice(1):b};g.prototype._register=function(b,e,a){e=e?e:this._routes;for(var f=0;f<b.length;f++){var c=b[f],d=c.onEnter,g=c.onExit,l=c.outlet,n=c.children,m=c.defaultRoute,m=void 0===m?!1:m,p=c.defaultParams,w=void 0===p?{}:
p,c=k.__read(c.path.split("?"),2),h=c[0],c=c[1],p=[],h=this._stripLeadingSlash(h),q=h.split("/"),d={params:[],outlet:l,path:h,segments:q,defaultParams:a?k.__assign({},a.defaultParams,w):w,children:[],fullPath:a?a.fullPath+"/"+h:h,fullParams:[],fullQueryParams:[],onEnter:d,onExit:g};m&&(this._defaultOutlet=l);for(g=0;g<q.length;g++)m=q[g],"string"===typeof m&&"{"===m[0]&&(d.params.push(m.replace("{","").replace("}","")),q[g]=u);c&&(p=c.split("$").map(function(a){return a.replace("{","").replace("}",
"")}));d.fullQueryParams=a?k.__spread(a.fullQueryParams,p):p;d.fullParams=a?k.__spread(a.fullParams,d.params):d.params;n&&0<n.length&&this._register(n,d.children,d);this._outletMap[l]=d;e.push(d)}};g.prototype._getQueryParams=function(b){var d={};if(b){b=b.split("\x26");for(var a=0;a<b.length;a++){var f=k.__read(b[a].split("\x3d"),2);d[f[0]]=f[1]}}return d};return g}(n.default);l.Router=d;l.default=d});