//>>built
(function(c){"object"===typeof module&&"object"===typeof module.exports?(c=c(require,exports),void 0!==c&&(module.exports=c)):"function"===typeof define&&define.amd&&define(["require","exports","tslib","./Pointer"],c)})(function(c,f){function h(a){return"[object Object]"===Object.prototype.toString.call(a)}function g(a,e){if(Array.isArray(a)&&Array.isArray(e))return a.length===e.length&&a.every(function(a,b){return g(a,e[b])});if(h(a)&&h(e)){var d=Object.keys(a).sort(),c=Object.keys(e).sort();return g(d,
c)&&d.every(function(d){return g(a[d],e[d])})}return a===e}function k(a,e){if(a.op===d.ADD){var c={op:d.REMOVE,path:a.path};return[{op:d.TEST,path:a.path,value:a.value},c]}if(a.op===d.REPLACE){var f=a.path.get(e),c=void 0,c=void 0===f?{op:d.REMOVE,path:a.path}:{op:d.REPLACE,path:a.path,value:a.path.get(e)};return[{op:d.TEST,path:a.path,value:a.value},c]}return[{op:d.ADD,path:a.path,value:a.path.get(e)}]}Object.defineProperty(f,"__esModule",{value:!0});var l=c("tslib"),m=c("./Pointer"),d;(function(a){a.ADD=
"add";a.REMOVE="remove";a.REPLACE="replace";a.TEST="test"})(d=f.OperationType||(f.OperationType={}));f.isObject=h;f.isEqual=g;c=function(){function a(a){this._operations=Array.isArray(a)?a:[a]}a.prototype.apply=function(a){var c=[];return{object:this._operations.reduce(function(a,e){var b;b=m.walk(e.path.segments,a);switch(e.op){case d.ADD:var f=e.value;Array.isArray(b.target)?b.target.splice(parseInt(b.segment,10),0,f):b.target[b.segment]=f;b=b.object;break;case d.REPLACE:f=e.value;Array.isArray(b.target)?
b.target.splice(parseInt(b.segment,10),1,f):b.target[b.segment]=f;b=b.object;break;case d.REMOVE:Array.isArray(b.target)?b.target.splice(parseInt(b.segment,10),1):delete b.target[b.segment];b=b.object;break;case d.TEST:if(!g(b.target[b.segment],e.value))throw Error("Test operation failure. Unable to apply any operations.");return a;default:throw Error("Unknown operation");}c=l.__spread(k(e,a),c);return b},a),undoOperations:c}};return a}();f.Patch=c});