//>>built
(function(b){"object"===typeof module&&"object"===typeof module.exports?(b=b(require,exports),void 0!==b&&(module.exports=b)):"function"===typeof define&&define.amd&&define(["require","exports","tslib","../../shim/iterator","./ExtensiblePromise"],b)})(function(b,f){function h(b){return!!(b&&"function"===typeof b.cancel&&Array.isArray(b.children)&&k(b))}function k(b){return b&&"function"===typeof b.then}Object.defineProperty(f,"__esModule",{value:!0});var l=b("tslib"),m=b("../../shim/iterator"),n=
b("./ExtensiblePromise");f.isTask=h;f.isThenable=k;b=function(b){function d(c,g){var a=this,e=function(){},d=function(){},a=b.call(this,function(a,c){e=a;d=c})||this;a._state=1;a.children=[];a.canceler=function(){g&&g();a._cancel()};try{c(function(c){3!==a._state&&(a._state=0,e(c))},function(c){3!==a._state&&(a._state=2,d(c))})}catch(p){a._state=2,d(p)}return a}l.__extends(d,b);d.race=function(c){return new this(function(b,a){Promise.race(n.unwrapPromises(c)).then(b,a)})};d.reject=function(c){return new this(function(b,
a){return a(c)})};d.resolve=function(c){return new this(function(b,a){return b(c)})};d.all=function(c){var g=this;return new d(function(a,e){b.all.call(g,c).then(a,e)},function(){if(m.isArrayLike(c))for(var a=0;a<c.length;a++){var b=c[a];h(b)&&b.cancel()}else if(m.isIterable(c))try{for(var a=l.__values(c),d=a.next();!d.done;d=a.next())b=d.value,h(b)&&b.cancel()}catch(q){g={error:q}}finally{try{d&&!d.done&&(f=a.return)&&f.call(a)}finally{if(g)throw g.error;}}else Object.keys(c).forEach(function(a){a=
c[a];h(a)&&a.cancel()});var g,f})};Object.defineProperty(d.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0});d.prototype._cancel=function(c){var b=this;this._state=3;var a=function(){try{return b._finally&&b._finally()}catch(e){}};this._finally&&(c=k(c)?c.then(a,a):a());this.children.forEach(function(a){a._cancel(c)})};d.prototype.cancel=function(){1===this._state&&this.canceler()};d.prototype.catch=function(b){return this.then(void 0,b)};d.prototype.finally=function(b){if(3===
this._state)return b(),this;var c=this.then(function(a){return d.resolve(b()).then(function(){return a})},function(a){return d.resolve(b()).then(function(){throw a;})});c._finally=b;return c};d.prototype.then=function(c,d){var a=this,e=b.prototype.then.call(this,function(a){if(3!==e._state)return c?c(a):a},function(a){if(3!==e._state){if(d)return d(a);throw a;}});e.canceler=function(){1===a._state?a.cancel():e._cancel()};this.children.push(e);return e};return d}(n.default);f.Task=b;f.default=b});